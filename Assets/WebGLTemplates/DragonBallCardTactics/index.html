<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>{{{ PRODUCT_NAME }}}</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="manifest" href="manifest.webmanifest">
    #if SHOW_DIAGNOSTICS
    <link rel="stylesheet" href="<<<TemplateData/diagnostics.css>>>">
    <script src="<<<TemplateData/diagnostics.js>>>"></script>
    #endif
</head>
<body>
    <!-- Mobile warning message -->
    <div id="mobile-warning">
        <div class="logo"></div>
        <h1>Non disponible sur mobile</h1>
        <p>
            Ce jeu n√©cessite un ordinateur pour fonctionner correctement.
        </p>
        <p>
            <strong>Utilisez un PC ou Mac</strong>
        </p>
    </div>

    <!-- Unity content (hidden on mobile) -->
    <div id="unity-container">
        <canvas id="unity-canvas" width={{{ WIDTH }}} height={{{ HEIGHT }}} tabindex="-1"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"> </div>
        #if SHOW_DIAGNOSTICS
        <div id="unity-footer">
            <img id="diagnostics-icon" src="TemplateData/webmemd-icon.png">
        </div>
        #endif
    </div>

    <script>
        window.addEventListener("load", function () {
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("ServiceWorker.js");
            }
        });

        var container = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loadingBar = document.querySelector("#unity-loading-bar");
        var progressBarFull = document.querySelector("#unity-progress-bar-full");
        var warningBanner = document.querySelector("#unity-warning");
        var mobileWarning = document.querySelector("#mobile-warning");

        // Enhanced mobile detection
        function isMobileDevice() {
            return /iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (window.innerWidth <= 768 && window.innerHeight <= 1024);
        }

        // Show mobile message or game based on device
        if (isMobileDevice()) {
            // Show mobile warning message
            mobileWarning.style.display = "flex";
            // Hide Unity container
            container.style.display = "none";
            // Prevent game loading
            console.log("Game not loaded: mobile device detected");
        } else {
            // Hide mobile message
            mobileWarning.style.display = "none";
            
            // Continue with normal Unity game loading
            function unityShowBanner(msg, type) {
                function updateBannerVisibility() {
                    warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
                }
                var div = document.createElement('div');
                div.innerHTML = msg;
                warningBanner.appendChild(div);
                if (type == 'error') div.style = 'background: red; padding: 10px;';
                else {
                    if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
                    setTimeout(function() {
                        warningBanner.removeChild(div);
                        updateBannerVisibility();
                    }, 5000);
                }
                updateBannerVisibility();
            }

            var buildUrl = "Build";
            var loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
            var config = {
                arguments: [],
                dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
                frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
                #if USE_THREADS
                workerUrl: buildUrl + "/{{{ WORKER_FILENAME }}}",
                #endif
                #if USE_WASM
                codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
                #endif
                #if SYMBOLS_FILENAME
                symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}",
                #endif
                streamingAssetsUrl: "StreamingAssets",
                companyName: {{{ JSON.stringify(COMPANY_NAME) }}},
                productName: {{{ JSON.stringify(PRODUCT_NAME) }}},
                productVersion: {{{ JSON.stringify(PRODUCT_VERSION) }}},
                showBanner: unityShowBanner,
            };

            #if SHOW_DIAGNOSTICS
            let diagnostics_icon = document.getElementById("diagnostics-icon");
            diagnostics_icon.style.position = "fixed";
            diagnostics_icon.style.bottom = "10px";
            diagnostics_icon.style.right = "0px";
            canvas.after(diagnostics_icon);
            #endif

            #if BACKGROUND_FILENAME
            canvas.style.background = "url('" + buildUrl + "/{{{ BACKGROUND_FILENAME.replace(/'/g, '%27') }}}') center / cover";
            #endif

            loadingBar.style.display = "block";

            var script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = () => {
                createUnityInstance(canvas, config, (progress) => {
                    progressBarFull.style.width = 100 * progress + "%";
                }).then((unityInstance) => {
                    setTimeout(() => {
                        loadingBar.style.display = "none";
                    }, 2000);
                    #if SHOW_DIAGNOSTICS
                    document.getElementById("diagnostics-icon").onclick = () => {
                        unityDiagnostics.openDiagnosticsDiv(unityInstance.GetMetricsInfo);
                    };
                    #endif
                }).catch((message) => {
                    alert(message);
                });
            };
            document.body.appendChild(script);
        }
    </script>
</body>
</html>